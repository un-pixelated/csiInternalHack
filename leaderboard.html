<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Leaderboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">

<style>
    /* GLOBAL STYLES */
    * {
        font-family: "Itim", cursive !important;
        box-sizing: border-box;
    }

    body {
        margin: 0;
        padding: 0;
        background-color: #E6D7A4;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    /* TOP BAR */
    .taskbar {
        width: 100%;
        height: 50px;
        background: #A9C9DA; 
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding-right: 30px;
        color: white;
        font-weight: 600;
        margin-bottom: 40px;
    }

    .taskbar a {
        color: white; 
        text-decoration: none; 
        margin-left: 20px;
    }

    /* CONTAINER FOR THE BOARD */
    .container {
        width: 60%;
        max-width: 800px;
        background: rgba(255, 255, 255, 0.25);
        border: 2px solid rgba(255, 255, 255, 0.6);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
    }

    h1 {
        color: #25637B;
        margin-bottom: 30px;
        font-size: 36px;
    }

    /* LEADERBOARD ROW STYLES */
    .row {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        border-bottom: 1px solid rgba(256, 256, 256, 0.5);
        font-size: 20px;
        color: #555;
    }

    .header-row {
        background-color: rgba(255, 255, 255, 0.4);
        border-radius: 10px;
        color: #25637B;
        font-weight: bold;
        border-bottom: none;
    }

    .box { flex: 1; text-align: center; }
    .rank { flex: 0.5; } /* Make rank column smaller */
    .name { flex: 2; text-align: left; padding-left: 20px;} /* Name column wider */
    .score { flex: 1; font-weight: bold; color: #d9534f; }

    /* LOGIN BOX STYLES (Kept from your original) */
    .input-box {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 2px dashed rgba(255,255,255,0.5);
    }
    
    input {
        padding: 10px;
        border-radius: 8px;
        border: none;
        margin: 5px;
        font-family: 'Itim', cursive;
    }

    button {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-family: 'Itim', cursive;
        font-size: 16px;
        transition: 0.2s;
    }

    .btn-login { background: #25637B; color: white; }
    .btn-reg { background: white; color: #25637B; }
    button:hover { opacity: 0.8; }

</style>
</head>
<body>

    <div class="taskbar">
        <a href="/">DASHBOARD</a>
        <a href="/difficulty.html">PLAY</a>
    </div>

    <div class="container">
        <h1>TOP PLAYERS</h1>

        <div class="row header-row">
            <div class="box rank">#</div>
            <div class="box name">PLAYER</div>
            <div class="box score">SCORE</div>
        </div>

        <div id="board">
            <div style="padding:20px;">Loading data...</div>
        </div>

        <div class="input-box">
            <p style="color:#25637B; margin-bottom:10px;">Login to save your scores!</p>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <br>
            <button class="btn-login" onclick="login(document.getElementById('username').value, document.getElementById('password').value)">LOGIN</button>
            <button class="btn-reg" onclick="register(document.getElementById('username').value, document.getElementById('password').value)">REGISTER</button>
        </div>
    </div>

    <script src="/static/auth.js"></script>
<script>
    async function loadLeaderboard() {
        const board = document.getElementById('board');
        
        try {
            console.log("Fetching leaderboard data...");
            const response = await fetch('/leaderboard'); 
            
            if (!response.ok) {
                const errText = await response.text();
                throw new Error(`Server Error (${response.status}): ${errText}`);
            }
            
            const data = await response.json();
            console.log("Data received:", data);

            // Clear the "Loading..." text
            board.innerHTML = "";

            if (data.length === 0) {
                board.innerHTML = "<div style='padding:20px; font-size:20px;'>No scores yet. Play a game to see your name here!</div>";
                return;
            }

            // Loop through data and create rows
            data.forEach((player, index) => {
                const row = document.createElement('div');
                row.className = 'row'; 
                row.innerHTML = `
                    <div class="box rank">${index + 1}</div>
                    <div class="box name">${player.username}</div>
                    <div class="box score">${player.score}</div>
                `;
                board.appendChild(row);
            });

        } catch (error) {
            console.error("Leaderboard Error:", error);
            // Show the error on screen so you know what happened
            board.innerHTML = `<div style='padding:20px; color:red; font-size:18px;'>
                <strong>Failed to load.</strong><br>
                ${error.message}
            </div>`;
        }
    }

    // Run this when page loads
    loadLeaderboard();
</script>